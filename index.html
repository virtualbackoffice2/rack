<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Merotra Network Table</title>

<style>
body { font-family: Arial; margin: 20px; }
h2 { margin-bottom: 12px; }
#matrixTable { border-collapse: collapse; width: 100%; }
#matrixTable th, #matrixTable td { border: 1px solid #ccc; padding: 4px 8px; text-align: center; }
#matrixTable th { background: #eee; position: sticky; top: 0; z-index: 2; }

/* clickable cells */
.clickable {
  cursor: pointer;
  color: blue;
  text-decoration: underline;
}

/* Modal styles */
#userModal {
  display: none;
  position: fixed;
  z-index: 10;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.5);
}
#userModalContent {
  background: #fff;
  margin: 10% auto;
  padding: 20px;
  border-radius: 6px;
  width: 400px;
  max-height: 60%;
  overflow-y: auto;
}
#userModalContent h3 { margin-top: 0; }
.closeBtn {
  float: right;
  cursor: pointer;
  font-weight: bold;
  color: #555;
}
.closeBtn:hover { color: red; }
</style>
</head>
<body>

<h2>Merotra Network</h2>
<div id="matrixHolder">
<table id="matrixTable">
<tr>
  <th></th>
  <th>Pon1</th><th>Pon2</th><th>Pon3</th><th>Pon4</th><th>Pon5</th><th>Pon6</th><th>Pon7</th><th>Pon8</th>
  <th>Pon9</th><th>Pon10</th><th>Pon11</th><th>Pon12</th><th>Pon13</th><th>Pon14</th><th>Pon15</th><th>Pon16</th>
  <th>Total</th>
</tr>

<!-- Main user counts -->
<tr>
  <th rowspan="3">O1I5</th>
  <td id="pon1" class="clickable">0</td>
  <td id="pon2" class="clickable">0</td>
  <td id="pon3" class="clickable">0</td>
  <td id="pon4" class="clickable">0</td>
  <td id="pon5" class="clickable">0</td>
  <td id="pon6" class="clickable">0</td>
  <td id="pon7" class="clickable">0</td>
  <td id="pon8" class="clickable">0</td>
  <td id="pon9" class="clickable">0</td>
  <td id="pon10" class="clickable">0</td>
  <td id="pon11" class="clickable">0</td>
  <td id="pon12" class="clickable">0</td>
  <td id="pon13" class="clickable">0</td>
  <td id="pon14" class="clickable">0</td>
  <td id="pon15" class="clickable">0</td>
  <td id="pon16" class="clickable">0</td>
  <td id="oltTotal">0</td>
</tr>

<!-- Offline counts -->
<tr>
  <td id="off1" class="clickable">0</td>
  <td id="off2" class="clickable">0</td>
  <td id="off3" class="clickable">0</td>
  <td id="off4" class="clickable">0</td>
  <td id="off5" class="clickable">0</td>
  <td id="off6" class="clickable">0</td>
  <td id="off7" class="clickable">0</td>
  <td id="off8" class="clickable">0</td>
  <td id="off9" class="clickable">0</td>
  <td id="off10" class="clickable">0</td>
  <td id="off11" class="clickable">0</td>
  <td id="off12" class="clickable">0</td>
  <td id="off13" class="clickable">0</td>
  <td id="off14" class="clickable">0</td>
  <td id="off15" class="clickable">0</td>
  <td id="off16" class="clickable">0</td>
  <td id="oltOffTotal">0</td>
</tr>

<!-- Ticket counts -->
<tr>
  <td id="tick1" class="clickable">0</td>
  <td id="tick2" class="clickable">0</td>
  <td id="tick3" class="clickable">0</td>
  <td id="tick4" class="clickable">0</td>
  <td id="tick5" class="clickable">0</td>
  <td id="tick6" class="clickable">0</td>
  <td id="tick7" class="clickable">0</td>
  <td id="tick8" class="clickable">0</td>
  <td id="tick9" class="clickable">0</td>
  <td id="tick10" class="clickable">0</td>
  <td id="tick11" class="clickable">0</td>
  <td id="tick12" class="clickable">0</td>
  <td id="tick13" class="clickable">0</td>
  <td id="tick14" class="clickable">0</td>
  <td id="tick15" class="clickable">0</td>
  <td id="tick16" class="clickable">0</td>
  <td id="oltTickTotal">0</td>
</tr>

</table>
</div>

<!-- Modal -->
<div id="userModal">
  <div id="userModalContent">
    <span class="closeBtn" onclick="closeModal()">&times;</span>
    <h3 id="modalTitle">User IDs</h3>
    <ul id="userList"></ul>
  </div>
</div>

<script>
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbz-FZM6fwvv0ruaSv-PbEG8sHNOmldJn6kXtRY6e7NZ9YlN3TJ5Oe9ECMwmGBTK-LMTnA/exec';
const TOKEN = 'abcd1234';

// Data storage
let oltData = {}; // { "O1I5P1": {all:[], off:[], tick:[]} }

async function loadData() {
  const url = WEB_APP_URL + '?token=' + encodeURIComponent(TOKEN);
  try {
    const response = await fetch(url);
    if (!response.ok) throw new Error('Network response was not ok: ' + response.statusText);
    const data = await response.json();
    if (data.error) throw new Error(data.error);

    const rows = data.rows || data || [];
    let total = 0, offTotal = 0, tickTotal = 0;

    for (let i=1; i<=16; i++) {
      const nmid = 'O1I5P' + i;
      const filtered = rows.filter(r => r['NMID'] === nmid && r['Users']);

      const allUsers = filtered.map(r => r['Users']);
      const offUsers = filtered.filter(r => r['Downs']).map(r => r['Users']);
      const tickUsers = filtered.filter(r => r['Ticket']).map(r => r['Users']);

      oltData[nmid] = { all: allUsers, off: offUsers, tick: tickUsers };

      document.getElementById('pon'+i).textContent = allUsers.length;
      document.getElementById('off'+i).textContent = offUsers.length;
      document.getElementById('tick'+i).textContent = tickUsers.length;

      total += allUsers.length;
      offTotal += offUsers.length;
      tickTotal += tickUsers.length;
    }

    document.getElementById('oltTotal').textContent = total;
    document.getElementById('oltOffTotal').textContent = offTotal;
    document.getElementById('oltTickTotal').textContent = tickTotal;

  } catch (err) {
    console.error('Fetch error:', err);
  }
}

// modal function
function showUsers(type, nmid) {
  let title = "User IDs";
  if (type==="off") title = "Offline Users";
  if (type==="tick") title = "Ticket Users";

  document.getElementById('modalTitle').textContent = title;

  const users = (oltData[nmid] && oltData[nmid][type]) || [];
  const list = document.getElementById('userList');
  list.innerHTML = '';
  if (users.length > 0) {
    users.forEach(u => {
      const li = document.createElement('li');
      li.textContent = u;
      list.appendChild(li);
    });
  } else {
    const li = document.createElement('li');
    li.textContent = 'No Users Found';
    list.appendChild(li);
  }
  document.getElementById('userModal').style.display = 'block';
}
function closeModal() {
  document.getElementById('userModal').style.display = 'none';
}

// attach listeners
for (let i=1; i<=16; i++) {
  document.getElementById('pon'+i).addEventListener('click', () => showUsers('all','O1I5P'+i));
  document.getElementById('off'+i).addEventListener('click', () => showUsers('off','O1I5P'+i));
  document.getElementById('tick'+i).addEventListener('click', () => showUsers('tick','O1I5P'+i));
}

window.addEventListener('load', loadData);
</script>
</body>
</html>
