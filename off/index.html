<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Complain Manager</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        crossorigin="anonymous" />

  <link rel="stylesheet" href="../stylesoff.css">

  <style>
    :root{
      --accent:#2b8cff;
      --danger:#e74c3c;
      --bg:#f7f8fb;
      --surface:#ffffff;
      --muted:#7f8c8d;
      --card-shadow:0 6px 18px rgba(23,31,46,0.06);
      --gap:12px;
    }
    html,body{
      height:100%;margin:0;padding:0;
      font-family:Inter,system-ui;
      background:var(--bg);color:#222;
    }
    header.app-header{
      display:flex;align-items:center;justify-content:space-between;
      padding:12px 16px;background:linear-gradient(#fff,#fbfdff);
      box-shadow:var(--card-shadow);
      position:sticky;top:0;z-index:1000;
    }
    .brand{display:flex;align-items:center;gap:12px;}
    .brand h1{margin:0;font-size:1.05rem;font-weight:600;}
    .hamburger{
      width:44px;height:44px;border:none;
      background:transparent;font-size:20px;
    }
    .top-controls{display:flex;gap:10px;flex-wrap:wrap;}
    .top-controls button{
      background:#fff;border:1px solid #e6e9ee;padding:8px 12px;
      border-radius:8px;font-size:0.95rem;
    }
    .top-controls .primary{background:var(--accent);color:#fff;}

    /* Drawer */
    .drawer{position:fixed;inset:0;pointer-events:none;z-index:1400;}
    .drawer-backdrop{
      position:absolute;inset:0;
      background:rgba(0,0,0,0.32);
      opacity:0;transition:.25s;
      pointer-events:none;
    }
    .drawer-panel{
      position:absolute;left:0;top:0;height:100%;width:320px;
      background:#fff;transform:translateX(-110%);
      transition:transform .36s cubic-bezier(.2,.9,.2,1);
      padding:16px;overflow:auto;
    }
    .drawer.open .drawer-backdrop{opacity:1;pointer-events:auto;}
    .drawer.open .drawer-panel{transform:translateX(0);}

    .filters-inline{
      display:flex;gap:10px;margin:12px 0;flex-wrap:wrap;
    }

    #tableWrap{margin:12px;background:transparent;overflow:auto;}
    table{width:100%;border-collapse:collapse;min-width:980px;background:#fff;}
    
    thead th{
      background:linear-gradient(#fff,#fbfdff);
      padding:12px 14px;border-bottom:1px solid #eef2f6;
      position:sticky;top:0;z-index:2;
      font-size:0.9rem;
      color:#000; /* ✅ header text black */
    }

    tbody td{
      padding:10px 14px;border-bottom:1px solid #f1f4f8;
      font-size:0.95rem;
    }

    tbody tr.offline td{background:#fffdf6;}

    tbody tr.ticket td{
      background:#ffe5e5;  /* ✅ red background */
    }

    .mark-btn,.remove-btn{
      width:36px;height:36px;border:none;border-radius:6px;
      background:#f1f5f9;margin-right:6px;
    }

    #spinnerOverlay{
      position:fixed;inset:0;display:none;
      align-items:center;justify-content:center;
      background:rgba(255,255,255,0.6);
      backdrop-filter:blur(2px);z-index:1200;
      flex-direction:column;gap:14px;
    }

    #toast{
      visibility:hidden;min-width:220px;
      background:#333;color:#fff;text-align:center;
      border-radius:8px;padding:12px 14px;
      position:fixed;left:50%;bottom:22px;
      transform:translateX(-50%) translateY(8px);
      opacity:0;transition:.25s;z-index:1300;
    }
    #toast.show{visibility:visible;opacity:1;transform:translateX(-50%) translateY(0);}

    @media(max-width:880px){
      .top-controls,.filters-inline{display:none;}
      .hamburger{display:flex;}
    }
    @media(min-width:881px){
      .hamburger,.drawer{display:none;}
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <header class="app-header">
    <div class="brand">
      <button class="hamburger" id="btnHamburger"><i class="fa fa-bars"></i></button>
      <h1>Complain Manager</h1>
    </div>

    <div class="top-controls">
      <button id="btnComplains" class="primary">Complains</button>
      <button id="btnOffline">Offline</button>
      <button id="btnDrops">Drops</button>
      <button id="btnDownloadCsv">CSV</button>
      <button id="btnScreenshotDownload">Screenshot</button>
    </div>
  </header>

  <!-- DRAWER -->
  <div class="drawer" id="appDrawer">
    <div class="drawer-backdrop" id="drawerBackdrop"></div>

    <aside class="drawer-panel">
      <div style="display:flex;justify-content:space-between;">
        <strong>Menu</strong>
        <button id="btnCloseDrawer" style="background:none;border:none;font-size:18px;">✕</button>
      </div>

      <div class="controls">
        <button id="m_btnComplains">Complains</button>
        <button id="m_btnOffline">Offline</button>
        <button id="m_btnDrops">Drops</button>
        <button id="m_btnDownloadCsv">CSV</button>
        <button id="m_btnScreenshot">Screenshot</button>
      </div>

      <div class="filters">
        <label>Window</label><select id="selWindow_mobile"></select>
        <label>PON</label><select id="selPon_mobile"></select>
        <label>User ID</label><input id="searchUser_mobile">
        <label>Mobile</label><input id="searchMobile_mobile">
        <label>Name</label><input id="searchName_mobile">
        <label>Mac/Serial</label><input id="searchMac_mobile">
        <div class="user-count">User count: <span id="userCount">0</span></div>
      </div>
    </aside>
  </div>

  <!-- DESKTOP FILTERS -->
  <div style="padding:12px 20px;">
    <div class="filters-inline">
      <select id="selWindow"></select>
      <select id="selPon"></select>
      <input id="searchUser" placeholder="User ID">
      <input id="searchMobile" placeholder="Mobile">
      <input id="searchName" placeholder="Name">
      <input id="searchMac" placeholder="Mac/Serial">
      <div class="user-count">User count: <span id="userCount_desktop">0</span></div>
    </div>
  </div>

  <!-- TABLE -->
  <div id="tableWrap">
    <table id="dataTable">
      <thead>
        <tr>
          <th class="sortable" data-key="NMID">PON</th>
          <th class="sortable" data-key="Users">User ID</th>
          <th>Mobile</th>
          <th>Name</th>
          <th>Mac / Serial</th>
          <th class="sortable" data-key="Drops">Down Time</th>
          <th>Remark</th>
          <th>Actions</th>
          <th>Location</th>
          <th>Procare</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- SPINNER -->
  <div id="spinnerOverlay"><div class="spinner"></div><p>Loading...</p></div>

  <!-- TOAST -->
  <div id="toast"></div>

  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

  <script>
    /* YOUR FULL JS — unchanged except search handler fix */

    ---- SAME JS AS YOUR FILE ----
    ---- ONLY ONE CHANGE BELOW ----

    /* SEARCH FIX */
    ['searchUser','searchMobile','searchName','searchMac'].forEach(id=>{
      const desk=document.getElementById(id);
      const mob=document.getElementById(id+'_mobile');
      desk.oninput=mob.oninput=()=>{
        if((desk.value||mob.value).length>=3){
          applyAllFilters();
        }
      };
    });

    /* DRAWER */
    document.addEventListener('DOMContentLoaded',()=>{
      const drawer=document.getElementById('appDrawer');
      document.getElementById('btnHamburger').onclick=()=>drawer.classList.add('open');
      document.getElementById('btnCloseDrawer').onclick=
      document.getElementById('drawerBackdrop').onclick=()=>drawer.classList.remove('open');

      fetchData();
    });
  </script>

</body>
</html>
